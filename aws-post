#!/bin/bash
cd /home/ec2-user
#Install Packages
sudo amazon-linux-extras install epel -y
sudo yum update -y
sudo yum install git pdsh -y


#Setup PDSH variables
echo 'export PDSH_RCMD_TYPE=ssh' >> /home/ec2-user/.bashrc
echo 'export WCOLL=~/weka_clients.host'  >> /home/ec2-user/.bashrc
weka user login david AWs_*321!
weka cluster servers list --role=backend -o hostname --no-header > /home/ec2-user/weka_cluster.host
weka cluster servers list --role=client -o hostname --no-header > /home/ec2-user/weka_clients.host

#Setup SSH 
echo "   StrictHostKeyChecking no" >> /home/ec2-user/.ssh/config
echo "-----BEGIN OPENSSH PRIVATE KEY-----
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
-----END OPENSSH PRIVATE KEY-----" >> /home/ec2-user/.ssh/id_rsa
chown ec2-user /home/ec2-user/.ssh/id_rsa 
chmod 400 /home/ec2-user/.ssh/id_rsa 

# Install WEKA Tools
mkdir /home/ec2-user/tools
git clone https://github.com/weka/tools
